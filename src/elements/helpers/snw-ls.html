<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-localstorage/iron-localstorage.html">
<link rel="import" href="snw-jwt-helper.html">

<dom-module id="snw-ls">
  <template>
    <snw-jwt-helper id="jwt"></snw-jwt-helper>
    <iron-localstorage id="lsjwt"
                       name="jwt-storage"
                       value="{{jwt}}"
                       on-iron-localstorage-load-empty="initializeDefault2"
    ></iron-localstorage>
    <iron-localstorage id="lsaccount"
                       name="account-storage"
                       value="{{account}}"
                       on-iron-localstorage-load-empty="initializeDefault"
    ></iron-localstorage>
  </template>

  <script>
    (function () {
      'use strict';
      Polymer({
        is: 'snw-ls',
        properties:{

          //Public

          /*****************************************************/
          //Private

          /**
           * Account stored in localstorage
           */
          account:{
            type: Object,
            notify: true,
            observer: '_accountChanged'
          },
          /**
           * Jwt stored in localstorage
           */
          jwt:{
            type: String,
            notify: true,
            observer: '_jwtChanged'
          }
        },

        initializeDefault: function () {
          this.account = {};
        },

        initializeDefault2: function () {
          this.jwt = "";
        },

        _accountChanged: function(e){
          var x = {
            type: 'account',
            e: e
          };
          this._changeEvent(x);
        },

        _jwtChanged: function(e){
          var x = {
            type: 'jwt',
            e: e
          };
          this._changeEvent(x);
        },

        _changeEvent: function(e){
          this.fire('ls-change', e);
        },

        deleteLs: function(type){
          this.set(type, null);
          this.$['ls'+type].save();
        },

        setLs: function(type, value){
          this.set(type, value);
        },

        getLs: function(type){
          this.$['ls'+type].reload();
          var ret = this[type];
          if(ret){
            return ret;
          }
          return '';
        }
      });
    })();
  </script>
</dom-module>