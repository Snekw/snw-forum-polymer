<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-localstorage/iron-localstorage.html">
<link rel="import" href="snw-jwt-helper.html">

<dom-module id="snw-ls">
  <template>
    <snw-jwt-helper id="jwt"></snw-jwt-helper>
    <iron-localstorage id="lsjwt"
                       name="jwt-storage"
                       value="{{_jwt}}"
                       on-iron-localstorage-load-empty="initializeDefault2"
    ></iron-localstorage>
    <iron-localstorage id="lsaccount"
                       name="account-storage"
                       value="{{_account}}"
                       on-iron-localstorage-load-empty="initializeDefault"
    ></iron-localstorage>
  </template>

  <script>
    (function () {
      'use strict';
      Polymer({
        is: 'snw-ls',
        properties:{

          //Public

          /*****************************************************/
          //Private

          /**
           * Account stored in localstorage
           */
          _account:{
            type: Object,
            notify: true,
            observer: '_accountChanged'
          },
          /**
           * Jwt stored in localstorage
           */
          _jwt:{
            type: String,
            notify: true,
            observer: '_jwtChanged'
          }
        },

        initializeDefault: function () {
          this._account = {};
        },

        initializeDefault2: function () {
          this._jwt = "";
        },

        _accountChanged: function(e){
          var x = {
            type: 'account',
            e: e
          };
          this._changeEvent(x);
        },

        _jwtChanged: function(e){
          var x = {
            type: 'jwt',
            e: e
          };
          this._changeEvent(x);
        },

        _changeEvent: function(e){
          this.fire('ls-change', e);
        },

        deleteLs: function(type){
          var _type = '_' + type;
          if(!this[_type]) return;

          this[_type] = "";
        },

        setLs: function(type, value){
          var _type = '_' + type;
          if(!this[_type]){
            this.set(_type, value);
          }
        },

        getLs: function(type){
          var _type = '_' + type;
          this.$['ls'+type].reload();
          var ret = this[_type];
          if(ret){
            return ret;
          }
          return '';
        }
      });
    })();
  </script>
</dom-module>