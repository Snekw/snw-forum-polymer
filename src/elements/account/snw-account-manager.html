<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="snw-account-manager">
  <template>
    <snw-jwt-helper id="jwtHelper"></snw-jwt-helper>
    <snw-ls id="sals" account="{{_account}}" jwt="{{_jwt}}"></snw-ls>
    <snw-ajax id="logoutAjax" cmd="/auth/logout" on-response="handleLogout"></snw-ajax>

    <!-- Logout dialog -->
    <paper-dialog id="logout" with-backdrop="true" on-iron-overlay-opened="logoutModalClose" entry-animation="scale-up-animation" exit-animation="fade-out-animation">
      <h2>You have logged out!</h2>
    </paper-dialog>
  </template>
  <script>
    (function () {
      'use strict';
      Polymer({
        is: 'snw-account-manager',

        properties:{
          //Public

          /*******************************************/
          //Private
          _jwt:{
            type: Object,
            value: {}
          },

          _account:{
            type: Object,
            value: {}
          },

          /*******************************************/
          //Methods

          /**
           * isLoggedIn
           * Returns true if the jwt is long enough :)
           * @returns {boolean}
           */
          isLoggedIn: function(){
            return this._jwt.length > 10;
          },


          logout: function () {
            this.$.sals.reload();
            if(this._jwt.length > 0)
            {
              this.$.logoutAjax.generateRequest();
            }
          },
          
          handleLogout: function(e){
            window.location = '/#/home';
            this.$.logout.open();

          },

          logoutModalClose: function(){
            setTimeout(this.$.logout.close(), 3000);
          }
        }
      });
    })();
  </script>
</dom-module>