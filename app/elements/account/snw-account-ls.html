<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">

<dom-module id="snw-account-ls">
    <template>
        <iron-localstorage id="lsjwt" name="jwt-storage"
                           value="{{jwt}}"
                           on-iron-localstorage-load-empty="initializeDefault2"></iron-localstorage>
        <iron-localstorage id="lsaccount" name="account-storage"
                           value="{{account}}"
                           on-iron-localstorage-load-empty="initializeDefault"></iron-localstorage>
    </template>


    <script>
        (function () {
            'use strict';
            Polymer({
                is: 'snw-account-ls',

                properties:{
                    account:{
                        type: Object,
                        notify: true
                    },
                    jwt:{
                        type: String,
                        notify: true
                    }
                },

                initializeDefault: function () {
                    this.account = {};
                },

                initializeDefault2: function () {
                    this.jwt = "";
                },

                reload: function(){
                    this.$.lsjwt.reload();
                    this.$.lsaccount.reload();
                },

                parseJwt: function (jwt) {
                    var token = jwt;
                    if(token && token != 'undefined'){
                        return JSON.parse(window.atob(token.split('.')[1]));
                    }else{
                        return null;
                    }
                },

                validateJwt: function (jwt) {
                    var token = this.parseJwt(jwt);

                    if(token && new Date(token.exp*100) < Date.now()){
                        return true;
                    }else{
                        return false;
                    }
                }
            });
        })();
    </script>
</dom-module>
