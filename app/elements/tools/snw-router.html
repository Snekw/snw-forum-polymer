<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="snw-router">
  <template>
    <carbon-location route="{{route}}" use-Hash-As-Path></carbon-location>
    <carbon-route route="{{route}}" pattern="/:page" data="{{pageData}}" tail="{{pageTail}}"></carbon-route>
    <carbon-route route="{{pageTail}}" pattern="/:id" data="{{tailData}}" tail="{{mTail}}"></carbon-route>
    <carbon-route route="{{mTail}}" pattern="/:m" data="{{mData}}"></carbon-route>


    <snw-protected-route path="/user/*/settings" data="{{data}}" redirect="true" scopes="{{userSettingsScopes}}"></snw-protected-route>
    <snw-protected-route path="/user/*/inbox" data="{{data}}" redirect="true" scopes="{{userInboxScopes}}"></snw-protected-route>
  </template>

  <script>
    (function () {
      'use strict';
      Polymer({
        is: 'snw-router',

        properties:{
          route:{
            type: Object,
            notify: true,
            observer: 'routeChanged'
          },
          data:{
            type: Object,
            notify: true
          },
          pageData: Object,
          tailData: Object,
          mData: Object,
          userSettingsScopes: Array,
          userInboxScopes: Array
        },

        ready:function () {
          this.userSettingsScopes = ['t:t'];
          this.userInboxScopes = ['t:t'];
        },

        routeChanged: function () {
          this.handle();
        },

        handle: function () {

          var d = {};

          if(!this.pageData || this.pageData.page == ''){
            //Redirect to home
            window.location = '/#/home';
            return;
          }

          d.page = this.pageData.page || null;

          if(this.tailData){
            d.id = this.tailData.id;
          }else{
            d.id = null;
          }

          if(this.mData){
            d.modifier = this.mData.m;
          }else{
            d.modifier = null;
          }
          this.data = d;
        }
      });
    })();
  </script>
</dom-module>
